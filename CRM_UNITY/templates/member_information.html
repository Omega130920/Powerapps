<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ contact_info.member_group_name }} Profile Information</title>
<style>
    /* CSS Variables for Theming */
    :root {
        --color-primary: #1b5e20; /* Dark Green */
        --color-secondary: #43a047; /* Medium Green */
        --color-light-green: #81c784; /* Light Green for buttons/tabs */
        --color-background-body: #d1e2c4; /* Page background */
        --color-background-container: #f0fff0; /* Container background */
        --color-border-light: #aed581; /* Light border/separator */
        --color-text-dark: #333;
        --font-size-base: 14px;
        --font-size-small: 13px;
    }
    /* Base Layout */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* This prevents scrolling */
    }
    
    body {
        font-family: sans-serif;
        font-size: 14px; /* Reduced base font size */
        background: linear-gradient(to bottom, #d1e2c4, #d1e2c4);
        color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .container {
        width: 95%;
        max-width: 98%;
        height: 90vh;
        display: flex;
        flex-direction: column;
        background-color: var(--color-background-container);
        padding: 1.5em;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Header and Buttons */
    .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    h1 {
        color: var(--color-primary);
        text-align: center;
        flex-grow: 1;
        font-size: 22px;
        margin: 0;
    }
    
    .btn {
        padding: 8px 16px;
        background-color: var(--color-light-green);
        border: 1px solid var(--color-light-green);
        border-radius: 5px;
        text-decoration: none;
        color: white;
        font-weight: bold;
        font-size: var(--font-size-small);
        transition: background-color 0.3s ease;
        cursor: pointer;
        text-align: center;
    }

    .btn:hover {
        background-color: #66bb6a; /* Slightly darker green */
    }
    
    .header > a {
        flex-shrink: 0; /* Prevents button from shrinking */
    }
    
    .header > div {
        /* Placeholder for alignment balance when needed */
        width: 138.8px; /* Approximate width of the button for center alignment of h1 */
    }

    /* Profile Layout (Tabs and Content) */
    .profile-layout {
        display: flex;
        gap: 15px;
        flex: 1;
        min-height: 0; /* Important for flex-child scrolling */
    }
    
    /* Vertical Tabs Navigation */
    .tab-nav {
        list-style-type: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        width: 180px;
        border-right: 2px solid var(--color-border-light);
        overflow-y: auto;
    }
    
    .tab-nav li {
        padding: 10px 15px;
        cursor: pointer;
        background-color: var(--color-light-green); 
        border: 1px solid var(--color-light-green);
        border-right: none;
        color: white;
        margin-bottom: 4px;
        border-radius: 5px 0 0 5px;
        white-space: nowrap;
        text-align: right;
        transition: all 0.2s ease;
        font-size: var(--font-size-small);
    }

    .tab-nav li.active {
        background-color: var(--color-background-container);
        color: var(--color-primary);
        border-top: 2px solid var(--color-secondary);
        border-bottom: 2px solid var(--color-secondary);
        border-left: 2px solid var(--color-secondary);
        font-weight: bold;
        transform: translateX(2px);
        z-index: 1;
    }

    .tab-nav li:hover:not(.active) {
        background-color: #66bb6a; 
    }

    /* Tab Content Area */
    .tab-content {
        flex: 1;
        background-color: var(--color-background-container);
        padding: 15px;
        border: 1px solid var(--color-border-light);
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
    }
    
    .tab-pane {
        display: none;
    }
    
    .tab-pane.active {
        display: block;
    }

    /* Table Styles */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 8px 12px;
        text-align: left;
        border-bottom: 1px solid var(--color-border-light);
        font-size: var(--font-size-small);
    }
    
    th {
        background-color: #e6ffe6;
        color: var(--color-primary);
        font-weight: bold;
    }

    tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .empty-message {
        text-align: center;
        padding: 15px;
        color: #777;
        font-style: italic;
        font-size: var(--font-size-small);
    }
    
    /* Notes and Documents Shared Styles */
    .content-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .content-section h2 {
        font-size: 1.2em;
        color: var(--color-primary);
        margin-bottom: 10px;
        border-bottom: 2px solid var(--color-border-light);
        padding-bottom: 5px;
    }
    
    .overview-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Two equal columns */
        gap: 20px;
        margin-top: 20px;
    }

    .card {
        background-color: var(--color-background-container); 
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--color-border-light);
    }

    .card h3 {
        color: var(--color-primary);
        border-bottom: 2px solid var(--color-border-light);
        padding-bottom: 8px;
        margin-bottom: 15px;
        font-size: 16px;
    }

    /* Styling the table inside the card for cleaner presentation */
    .card .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    .card .data-table th, .card .data-table td {
        padding: 8px 0;
        text-align: left;
        border-bottom: 1px dotted #ccc;
    }
    .card .data-table th {
        width: 45%;
        font-weight: bold;
        color: var(--color-text-dark);
    }

    /* Ensure single column layout on small screens */
    @media (max-width: 768px) {
        .overview-grid {
            grid-template-columns: 1fr;
        }
    }
    

/* -------------------------------------- */
/* CSS ANIMATION: Two ACTIVE SVG Stick Figures Talking (FINAL) */
/* -------------------------------------- */

.talking-scene {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 60px;
    width: 150px;
    position: relative;
}

.person-svg {
    margin: 0 10px;
    overflow: visible; 
    animation: bounce 1.5s infinite ease-in-out;
}

.person-svg circle, .person-svg line {
    stroke-width: 2;
    stroke-linecap: round;
}

.person-svg .arms-line {
    transform-origin: 20px 25px; 
    animation: arm-fidget 3s infinite ease-in-out; 
}

.person-svg .left-leg {
    transform-origin: 20px 35px; 
    animation: leg-shift 3s infinite ease-in-out;
}

.person-svg .right-leg {
    transform-origin: 20px 35px; 
    animation: leg-shift 3s infinite ease-in-out 1.5s;
}

.person-svg .mouth-line {
    animation: open-mouth 3s infinite;
    animation-delay: 0s;
}

.person-svg.person-2 .mouth-line {
    animation-delay: 1.5s; 
}

.speech-bubble {
    position: absolute;
    bottom: 55px;
    transform: translateX(-50%) scale(0);
    width: 10px;
    height: 10px;
    background-color: var(--color-secondary);
    border-radius: 50%;
    opacity: 0;
    animation: talk 3s infinite;
    z-index: 3;
}

.talking-scene > .speech-bubble:nth-child(1) {
    animation-delay: 0s;
    left: calc(50% - 15px); 
}

.talking-scene > .speech-bubble:nth-child(2) {
    animation-delay: 1.5s;
    left: calc(50% + 15px); 
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

@keyframes talk {
    0%, 15% { transform: translateX(-50%) scale(0); opacity: 0; }
    20% { transform: translateX(-50%) scale(1.2); opacity: 1; }
    30%, 45% { transform: translateX(-50%) scale(1); opacity: 1; }
    50%, 100% { transform: translateX(-50%) scale(0); opacity: 0; }
}

@keyframes open-mouth {
    0%, 15% { transform: translateY(0px); } 
    20% { transform: translateY(2px); } 
    30%, 45% { transform: translateY(1.5px); } 
    50%, 100% { transform: translateY(0px); }
}

@keyframes arm-fidget {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(2px) rotate(2deg); }
    75% { transform: translateY(-2px) rotate(-2deg); }
}

@keyframes leg-shift {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(-5deg); }
}

/* -------------------------------------- */
/* NEW/UPDATED STYLES FOR EMAIL LOG */
/* -------------------------------------- */

.email-log-table {
    width: 100%;
    border-collapse: collapse;
}
.email-log-table th {
    background-color: #f0f4c3; 
    color: #43a047;
    padding: 10px 15px;
    text-align: left;
    font-size: 14px;
    border-bottom: 2px solid #aed581;
}
.email-log-table td {
    padding: 10px 15px;
    border-bottom: 1px solid #eee;
    font-size: 13px;
    word-wrap: break-word;
}
.email-log-table tr:hover {
    background-color: #f5f5f5;
}
.email-log-table a {
    color: #43a047; 
    text-decoration: none;
    font-weight: 500;
}
.email-log-table a:hover {
    text-decoration: underline;
}

.status-delegated { color: #1e88e5; font-weight: bold; }
.status-actioned { color: #2e7d32; font-weight: bold; }
.status-recycled { color: #f4511e; font-weight: bold; }
.status-not.actioned { color: #888; }

.email-composition-area {
    margin-top: 15px; 
    padding: 15px; 
    border: 2px dashed #1e88e5; 
    border-radius: 8px; 
    background-color: #e3f2fd; 
}
.email-composition-area h2 {
    color: #1e88e5 !important;
}
.email-composition-area input[type="text"], 
.email-composition-area input[type="email"] {
    width: 100%; 
    padding: 8px; 
    border: 1px solid #90caf9; 
    border-radius: 4px;
}
.email-composition-area .rich-text-editor {
    min-height: 250px; 
    border: 1px solid #1e88e5 !important; 
    padding: 10px; 
    border-radius: 4px; 
    background-color: white;
}

/* -------------------------------------- */
/* ADDED: ACTION BUTTON STYLES FOR EMAIL LOG (VIEW/DOWNLOAD) */
/* -------------------------------------- */

.email-log-actions {
    display: flex; 
    gap: 8px; 
    justify-content: center;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: white !important; /* Force white text */
    padding: 6px 12px;
    border-radius: 4px;
    text-decoration: none !important;
    font-size: 0.8rem;
    font-weight: bold;
    transition: opacity 0.2s;
}

.action-btn:hover {
    opacity: 0.85;
    text-decoration: none !important;
}

.bg-view { background-color: #43a047; }    /* Green */
.bg-download { background-color: #1976d2; } /* Blue */

</style>
<body>
    <div class="container">
        <div class="header">
            <a href="{% url 'global_members_list' %}" class="btn">Return to Global List</a>
            <h1>{{ contact_info.member_group_code }} - {{ contact_info.member_group_name }} Profile</h1>
           
            <div class="talking-scene">
                <svg width="40" height="60" viewBox="0 0 40 60" class="person-svg person-1">
                    <circle cx="20" cy="8" r="7" fill="var(--color-primary)" style="stroke: var(--color-primary);"/>
                   
                    <line x1="17" y1="10" x2="23" y2="10" class="mouth-line" style="stroke: white; stroke-width: 1.5;"/>
                   
                    <line x1="20" y1="15" x2="20" y2="35" style="stroke: var(--color-primary);"/>
                    <line x1="10" y1="25" x2="30" y2="25" class="arms-line" style="stroke: var(--color-primary);"/>
                    <line x1="20" y1="35" x2="15" y2="50" class="left-leg" style="stroke: var(--color-primary);"/>
                    <line x1="20" y1="35" x2="25" y2="50" class="right-leg" style="stroke: var(--color-primary);"/>
                </svg>

                <svg width="40" height="60" viewBox="0 0 40 60" class="person-svg person-2">
                    <circle cx="20" cy="8" r="7" fill="var(--color-secondary)" style="stroke: var(--color-secondary);"/>

                    <line x1="17" y1="10" x2="23" y2="10" class="mouth-line" style="stroke: white; stroke-width: 1.5;"/>

                    <line x1="20" y1="15" x2="20" y2="35" style="stroke: var(--color-secondary);"/>
                    <line x1="10" y1="25" x2="30" y2="25" class="arms-line" style="stroke: var(--color-secondary);"/>
                    <line x1="20" y1="35" x2="15" y2="50" class="left-leg" style="stroke: var(--color-secondary);"/>
                    <line x1="20" y1="35" x2="25" y2="50" class="right-leg" style="stroke: var(--color-secondary);"/>
                </svg>

                <div class="speech-bubble"></div>
                <div class="speech-bubble"></div>

            </div>
        </div>

        <div class="profile-layout">
            <ul class="tab-nav">
                <li class="active" data-tab-target="#overview">Member Group</li>
                <li data-tab-target="#general-info">General Info</li>
                <li data-tab-target="#cbc">CBC</li>
                <li data-tab-target="#cbc-admin">CBC Admin</li>
                <li data-tab-target="#cbc-consultancy">CBC Consultancy</li>
                <li data-tab-target="#cfa">CFA</li>
                <li data-tab-target="#cfa-admin">CFA Admin</li>
                <li data-tab-target="#cfa2">CFA 2</li>
                <li data-tab-target="#cfa3">CFA 3</li>
                <li data-tab-target="#communications">Communications</li>
                <li data-tab-target="#hr">Human Resources</li>
                <li data-tab-target="#section13a">Section 13A</li>
                <li data-tab-target="#email-log">üìß Email Log</li>
                <li data-tab-target="#compose-email">‚úèÔ∏è Compose Email</li> <!-- NEW TAB -->
                <li data-tab-target="#notes">Notes</li>
                <li data-tab-target="#pdf-documents">PDF Documents</li>
            </ul>

            <div class="tab-content">
               
                <section id="overview" class="tab-pane active">
                    <h2>Member Group Overview & Financial Summary</h2>
                    <div class="overview-grid">
                       
                        <div class="card contact-info-card">
                            <h3>Contact & Status</h3>
                            <table class="data-table">
                                <tbody>
                                    <tr><th>Member Group Name</th><td>{{ contact_info.member_group_name|default:"N/A" }}</td></tr>
                                    <tr><th>Fund Status</th><td>{{ contact_info.fund_status|default:"N/A" }}</td></tr>
                                    <tr><th>Start Date</th><td>{{ contact_info.commencement_date|date:"Y-m-d"|default:"N/A" }}</td></tr>
                                    <tr><th>Contact Number</th><td>{{ contact_info.work_contact_number|default:"N/A" }}</td></tr>
                                    <tr><th>Postal Address</th><td>{{ contact_info.business_postal_address|default:"N/A" }}</td></tr>
                                </tbody>
                            </table>
                        </div>
                       
                        <div class="card financial-summary-card">
                            <h3>Financial Summary</h3>
                            <table class="data-table">
                                <tbody>
                                    <tr><th>Monthly Contribution</th><td>R {{ financial_data.monthly_contribution|floatformat:2|default:"0.00" }}</td></tr>
                                    <tr><th>Last Amount Paid</th><td>R {{ financial_data.last_payment_amount|floatformat:2|default:"0.00" }}</td></tr>
                                    <tr><th>Last Payment Date</th><td>{{ financial_data.last_payment_date|date:"Y-m-d"|default:"N/A" }}</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
               
                <section id="general-info" class="tab-pane">
                    <div id="general-info-display">
                        <h2>General Information Overview 
                            <button class="btn btn-sm edit-toggle-btn" data-target="general-info-edit" data-parent-tab="general-info" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">Edit</button>
                        </h2>
                       
                        {% if contact_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Member Group Code</th><td>{{ contact_info.member_group_code }}</td></tr>
                                <tr><th>Member Group Name</th><td>{{ contact_info.member_group_name|default:"N/A" }}</td></tr>
                                <tr><th>Commencement Date</th><td>{{ contact_info.commencement_date|date:'Y-m-d'|default:"N/A" }}</td></tr>
                                <tr><th>Fund Status</th><td>{{ contact_info.fund_status|default:"N/A" }}</td></tr>
                                <tr><th>Postal Address</th><td>{{ contact_info.business_postal_address|default:"N/A" }}</td></tr>
                                <tr><th>Postal Code</th><td>{{ contact_info.business_postal_address_post_code|default:"N/A" }}</td></tr>
                                <tr><th>Physical Address</th><td>{{ contact_info.business_physical_address2|default:"N/A" }}</td></tr>
                                <tr><th>Physical Code</th><td>{{ contact_info.business_physical_address_post_code2|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p>No General Contact Information found.</p>
                        {% endif %}
                    </div>

                    <div id="general-info-edit" style="display: none;">
                        <h2>Edit General Information
                            <button class="btn btn-sm edit-toggle-btn" data-target="general-info-display" data-parent-tab="general-info" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_global_contact">
                           
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_member_group_name" style="font-weight: bold;">Member Group Name</label>
                                <input type="text" id="id_member_group_name" name="member_group_name" class="form-control" 
                                       value="{{ contact_info.member_group_name|default:'' }}" required style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_commencement_date" style="font-weight: bold;">Commencement Date</label>
                                <input type="date" id="id_commencement_date" name="commencement_date" class="form-control" 
                                       value="{{ contact_info.commencement_date|date:'Y-m-d'|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>

                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_fund_status" style="font-weight: bold;">Fund Status</label>
                                <input type="text" id="id_fund_status" name="fund_status" class="form-control" 
                                       value="{{ contact_info.fund_status|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_business_postal_address" style="font-weight: bold;">Postal Address</label>
                                <input type="text" id="id_business_postal_address" name="business_postal_address" class="form-control" 
                                       value="{{ contact_info.business_postal_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_business_postal_address_post_code" style="font-weight: bold;">Postal Code</label>
                                <input type="text" id="id_business_postal_address_post_code" name="business_postal_address_post_code" class="form-control" 
                                       value="{{ contact_info.business_postal_address_post_code|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_business_physical_address2" style="font-weight: bold;">Physical Address</label>
                                <input type="text" id="id_business_physical_address2" name="business_physical_address2" class="form-control" 
                                       value="{{ contact_info.business_physical_address2|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                            <div class="form-group" style="margin-bottom: 15px;">
                                <label for="id_business_physical_address_post_code2" style="font-weight: bold;">Physical Code</label>
                                <input type="text" id="id_business_physical_address_post_code2" name="business_physical_address_post_code2" class="form-control" 
                                       value="{{ contact_info.business_physical_address_post_code2|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer;">Save General Info</button>
                        </form>
                    </div>
                </section>

                <section id="cbc" class="tab-pane">
                    <div id="cbc-display">
                        <h2>CBC Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cbc-edit" data-parent-tab="cbc" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cbc_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cbc_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cbc_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cbc_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cbc_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cbc_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cbc_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Indemnity</th><td>{{ cbc_info.indemnity|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cbc_info.work_dial_code|default:"" }} {{ cbc_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cbc_info.fax_dial_code|default:"" }} {{ cbc_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cbc_info.mobile_number|default:"N/A" }}</td></tr>
                                <tr><th>Postal Address</th><td>{{ cbc_info.business_postal_address|default:"N/A" }}</td></tr>
                                <tr><th>Postal Code</th><td>{{ cbc_info.post_code|default:"N/A" }}</td></tr>
                                <tr><th>Physical Address</th><td>{{ cbc_info.business_physical_address|default:"N/A" }}</td></tr>
                                <tr><th>Physical Code</th><td>{{ cbc_info.post_code2|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CBC information available for this member. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cbc-edit" style="display: none;">
                        <h2>{% if cbc_info %}Edit{% else %}Add{% endif %} CBC Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cbc-display" data-parent-tab="cbc" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cbc">
                           
                            {% comment %} Simple fields {% endcomment %}
                            <div class="form-group"><label for="id_title">Title</label><input type="text" id="id_title" name="title" class="form-control" value="{{ cbc_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_first_name">First Name</label><input type="text" id="id_first_name" name="first_name" class="form-control" value="{{ cbc_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_surname">Surname</label><input type="text" id="id_surname" name="surname" class="form-control" value="{{ cbc_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_id_number">ID Number</label><input type="text" id="id_id_number" name="id_number" class="form-control" value="{{ cbc_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_email_address">E-mail</label><input type="email" id="id_email_address" name="email_address" class="form-control" value="{{ cbc_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_indemnity">Indemnity</label><input type="text" id="id_indemnity" name="indemnity" class="form-control" value="{{ cbc_info.indemnity|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            {% comment %} Phone numbers (simplified) {% endcomment %}
                            <div class="form-group">
                                <label for="id_work_contact_number">Work Number</label>
                                <input type="text" id="id_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cbc_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cbc_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_fax_number">Fax Number</label>
                                <input type="text" id="id_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cbc_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_fax_number" name="fax_number" placeholder="Number" value="{{ cbc_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_mobile_number">Mobile Number</label><input type="text" id="id_mobile_number" name="mobile_number" class="form-control" value="{{ cbc_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>

                            {% comment %} Address fields {% endcomment %}
                            <div class="form-group"><label for="id_business_postal_address">Postal Address</label><input type="text" id="id_business_postal_address" name="business_postal_address" class="form-control" value="{{ cbc_info.business_postal_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_post_code">Postal Code</label><input type="text" id="id_post_code" name="post_code" class="form-control" value="{{ cbc_info.post_code|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_business_physical_address">Physical Address</label><input type="text" id="id_business_physical_address" name="business_physical_address" class="form-control" value="{{ cbc_info.business_physical_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_post_code2">Physical Code</label><input type="text" id="id_post_code2" name="post_code2" class="form-control" value="{{ cbc_info.post_code2|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CBC Info</button>
                        </form>
                    </div>
                </section>
               
                <section id="cbc-admin" class="tab-pane">
                    <div id="cbc-admin-display">
                        <h2>CBC Admin Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cbc-admin-edit" data-parent-tab="cbc-admin" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cbc_admin_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cbc_admin_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cbc_admin_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cbc_admin_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cbc_admin_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cbc_admin_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cbc_admin_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cbc_admin_info.work_dial_code|default:"" }} {{ cbc_admin_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cbc_admin_info.fax_dial_code|default:"" }} {{ cbc_admin_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cbc_admin_info.mobile_number|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CBC Admin Person information available. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cbc-admin-edit" style="display: none;">
                        <h2>{% if cbc_admin_info %}Edit{% else %}Add{% endif %} CBC Admin Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cbc-admin-display" data-parent-tab="cbc-admin" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cbc_admin">
                           
                            {% comment %} Simple fields {% endcomment %}
                            <div class="form-group"><label for="id_admin_title">Title</label><input type="text" id="id_admin_title" name="title" class="form-control" value="{{ cbc_admin_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_admin_first_name">First Name</label><input type="text" id="id_admin_first_name" name="first_name" class="form-control" value="{{ cbc_admin_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_admin_surname">Surname</label><input type="text" id="id_admin_surname" name="surname" class="form-control" value="{{ cbc_admin_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_admin_id_number">ID Number</label><input type="text" id="id_admin_id_number" name="id_number" class="form-control" value="{{ cbc_admin_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_admin_email_address">E-mail</label><input type="email" id="id_admin_email_address" name="email_address" class="form-control" value="{{ cbc_admin_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            {% comment %} Phone numbers (simplified) {% endcomment %}
                            <div class="form-group">
                                <label for="id_admin_work_contact_number">Work Number</label>
                                <input type="text" id="id_admin_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cbc_admin_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_admin_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cbc_admin_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_admin_fax_number">Fax Number</label>
                                <input type="text" id="id_admin_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cbc_admin_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_admin_fax_number" name="fax_number" placeholder="Number" value="{{ cbc_admin_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_admin_mobile_number">Mobile Number</label><input type="text" id="id_admin_mobile_number" name="mobile_number" class="form-control" value="{{ cbc_admin_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CBC Admin Info</button>
                        </form>
                    </div>
                </section>
               
                <section id="cbc-consultancy" class="tab-pane">
                    <div id="cbc-consultancy-display">
                        <h2>CBC Consultancy Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cbc-consultancy-edit" data-parent-tab="cbc-consultancy" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cbc_consultancy_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cbc_consultancy_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cbc_consultancy_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cbc_consultancy_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cbc_consultancy_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cbc_consultancy_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cbc_consultancy_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cbc_consultancy_info.work_dial_code|default:"" }} {{ cbc_consultancy_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cbc_consultancy_info.fax_dial_code|default:"" }} {{ cbc_consultancy_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cbc_consultancy_info.mobile_number|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CBC Consultancy Person information available. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cbc-consultancy-edit" style="display: none;">
                        <h2>{% if cbc_consultancy_info %}Edit{% else %}Add{% endif %} CBC Consultancy Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cbc-consultancy-display" data-parent-tab="cbc-consultancy" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cbc_consultancy">
                           
                            {% comment %} Simple fields {% endcomment %}
                            <div class="form-group"><label for="id_consult_title">Title</label><input type="text" id="id_consult_title" name="title" class="form-control" value="{{ cbc_consultancy_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_consult_first_name">First Name</label><input type="text" id="id_consult_first_name" name="first_name" class="form-control" value="{{ cbc_consultancy_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_consult_surname">Surname</label><input type="text" id="id_consult_surname" name="surname" class="form-control" value="{{ cbc_consultancy_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_consult_id_number">ID Number</label><input type="text" id="id_consult_id_number" name="id_number" class="form-control" value="{{ cbc_consultancy_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_consult_email_address">E-mail</label><input type="email" id="id_consult_email_address" name="email_address" class="form-control" value="{{ cbc_consultancy_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            {% comment %} Phone numbers (simplified) {% endcomment %}
                            <div class="form-group">
                                <label for="id_consult_work_contact_number">Work Number</label>
                                <input type="text" id="id_consult_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cbc_consultancy_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_consult_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cbc_consultancy_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_consult_fax_number">Fax Number</label>
                                <input type="text" id="id_consult_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cbc_consultancy_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_consult_fax_number" name="fax_number" placeholder="Number" value="{{ cbc_consultancy_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_consult_mobile_number">Mobile Number</label><input type="text" id="id_consult_mobile_number" name="mobile_number" class="form-control" value="{{ cbc_consultancy_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CBC Consultancy Info</button>
                        </form>
                    </div>
                </section>

                <section id="cfa" class="tab-pane">
                    <div id="cfa-display">
                        <h2>CFA Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa-edit" data-parent-tab="cfa" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cfa_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cfa_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cfa_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cfa_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cfa_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cfa_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cfa_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cfa_info.work_dial_code|default:"" }} {{ cfa_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cfa_info.fax_dial_code|default:"" }} {{ cfa_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cfa_info.mobile_number|default:"N/A" }}</td></tr>
                                <tr><th>Postal Address</th><td>{{ cfa_info.business_postal_address|default:"N/A" }}</td></tr>
                                <tr><th>Postal Code</th><td>{{ cfa_info.post_code|default:"N/A" }}</td></tr>
                                <tr><th>Physical Address</th><td>{{ cfa_info.business_physical_address|default:"N/A" }}</td></tr>
                                <tr><th>Physical Code</th><td>{{ cfa_info.post_code2|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CFA information available for this member. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cfa-edit" style="display: none;">
                        <h2>{% if cfa_info %}Edit{% else %}Add{% endif %} CFA Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa-display" data-parent-tab="cfa" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cfa">
                           
                            {% comment %} Simple fields {% endcomment %}
                            <div class="form-group"><label for="id_cfa_title">Title</label><input type="text" id="id_cfa_title" name="title" class="form-control" value="{{ cfa_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_first_name">First Name</label><input type="text" id="id_cfa_first_name" name="first_name" class="form-control" value="{{ cfa_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_surname">Surname</label><input type="text" id="id_cfa_surname" name="surname" class="form-control" value="{{ cfa_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_id_number">ID Number</label><input type="text" id="id_cfa_id_number" name="id_number" class="form-control" value="{{ cfa_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_email_address">E-mail</label><input type="email" id="id_cfa_email_address" name="email_address" class="form-control" value="{{ cfa_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            {% comment %} Phone numbers (simplified) {% endcomment %}
                            <div class="form-group">
                                <label for="id_cfa_work_contact_number">Work Number</label>
                                <input type="text" id="id_cfa_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cfa_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cfa_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_cfa_fax_number">Fax Number</label>
                                <input type="text" id="id_cfa_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cfa_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa_fax_number" name="fax_number" placeholder="Number" value="{{ cfa_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_cfa_mobile_number">Mobile Number</label><input type="text" id="id_cfa_mobile_number" name="mobile_number" class="form-control" value="{{ cfa_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>

                            {% comment %} Address fields {% endcomment %}
                            <div class="form-group"><label for="id_cfa_business_postal_address">Postal Address</label><input type="text" id="id_cfa_business_postal_address" name="business_postal_address" class="form-control" value="{{ cfa_info.business_postal_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_post_code">Postal Code</label><input type="text" id="id_cfa_post_code" name="post_code" class="form-control" value="{{ cfa_info.post_code|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_business_physical_address">Physical Address</label><input type="text" id="id_cfa_business_physical_address" name="business_physical_address" class="form-control" value="{{ cfa_info.business_physical_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_post_code2">Physical Code</label><input type="text" id="id_cfa_post_code2" name="post_code2" class="form-control" value="{{ cfa_info.post_code2|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CFA Info</button>
                        </form>
                    </div>
                </section>

                <section id="cfa-admin" class="tab-pane">
                    <div id="cfa-admin-display">
                        <h2>CFA Admin Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa-admin-edit" data-parent-tab="cfa-admin" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cfa_admin_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cfa_admin_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cfa_admin_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cfa_admin_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cfa_admin_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cfa_admin_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cfa_admin_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cfa_admin_info.work_dial_code|default:"" }} {{ cfa_admin_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cfa_admin_info.fax_dial_code|default:"" }} {{ cfa_admin_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cfa_admin_info.mobile_number|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CFA Admin Person information available. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cfa-admin-edit" style="display: none;">
                        <h2>{% if cfa_admin_info %}Edit{% else %}Add{% endif %} CFA Admin Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa-admin-display" data-parent-tab="cfa-admin" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cfa_admin">
                           
                            <div class="form-group"><label for="id_cfa_admin_title">Title</label><input type="text" id="id_cfa_admin_title" name="title" class="form-control" value="{{ cfa_admin_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_admin_first_name">First Name</label><input type="text" id="id_cfa_admin_first_name" name="first_name" class="form-control" value="{{ cfa_admin_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_admin_surname">Surname</label><input type="text" id="id_cfa_admin_surname" name="surname" class="form-control" value="{{ cfa_admin_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_admin_id_number">ID Number</label><input type="text" id="id_cfa_admin_id_number" name="id_number" class="form-control" value="{{ cfa_admin_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa_admin_email_address">E-mail</label><input type="email" id="id_cfa_admin_email_address" name="email_address" class="form-control" value="{{ cfa_admin_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <div class="form-group">
                                <label for="id_cfa_admin_work_contact_number">Work Number</label>
                                <input type="text" id="id_cfa_admin_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cfa_admin_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa_admin_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cfa_admin_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_cfa_admin_fax_number">Fax Number</label>
                                <input type="text" id="id_cfa_admin_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cfa_admin_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa_admin_fax_number" name="fax_number" placeholder="Number" value="{{ cfa_admin_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_cfa_admin_mobile_number">Mobile Number</label><input type="text" id="id_cfa_admin_mobile_number" name="mobile_number" class="form-control" value="{{ cfa_admin_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CFA Admin Info</button>
                        </form>
                    </div>
                </section>

                <section id="cfa2" class="tab-pane">
                    <div id="cfa2-display">
                        <h2>CFA 2 Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa2-edit" data-parent-tab="cfa2" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cfa2_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cfa2_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cfa2_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cfa2_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cfa2_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cfa2_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cfa2_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cfa2_info.work_dial_code|default:"" }} {{ cfa2_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cfa2_info.fax_dial_code|default:"" }} {{ cfa2_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cfa2_info.mobile_number|default:"N/A" }}</td></tr>
                                <tr><th>Postal Address</th><td>{{ cfa2_info.business_postal_address|default:"N/A" }}</td></tr>
                                <tr><th>Postal Code</th><td>{{ cfa2_info.post_code|default:"N/A" }}</td></tr>
                                <tr><th>Physical Address</th><td>{{ cfa2_info.business_physical_address|default:"N/A" }}</td></tr>
                                <tr><th>Physical Code</th><td>{{ cfa2_info.post_code2|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CFA 2 information available for this member. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cfa2-edit" style="display: none;">
                        <h2>{% if cfa2_info %}Edit{% else %}Add{% endif %} CFA 2 Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa2-display" data-parent-tab="cfa2" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cfa2">
                           
                            <div class="form-group"><label for="id_cfa2_title">Title</label><input type="text" id="id_cfa2_title" name="title" class="form-control" value="{{ cfa2_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_first_name">First Name</label><input type="text" id="id_cfa2_first_name" name="first_name" class="form-control" value="{{ cfa2_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_surname">Surname</label><input type="text" id="id_cfa2_surname" name="surname" class="form-control" value="{{ cfa2_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_id_number">ID Number</label><input type="text" id="id_cfa2_id_number" name="id_number" class="form-control" value="{{ cfa2_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_email_address">E-mail</label><input type="email" id="id_cfa2_email_address" name="email_address" class="form-control" value="{{ cfa2_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <div class="form-group">
                                <label for="id_cfa2_work_contact_number">Work Number</label>
                                <input type="text" id="id_cfa2_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cfa2_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa2_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cfa2_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_cfa2_fax_number">Fax Number</label>
                                <input type="text" id="id_cfa2_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cfa2_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa2_fax_number" name="fax_number" placeholder="Number" value="{{ cfa2_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_cfa2_mobile_number">Mobile Number</label><input type="text" id="id_cfa2_mobile_number" name="mobile_number" class="form-control" value="{{ cfa2_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>

                            <div class="form-group"><label for="id_cfa2_business_postal_address">Postal Address</label><input type="text" id="id_cfa2_business_postal_address" name="business_postal_address" class="form-control" value="{{ cfa2_info.business_postal_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_post_code">Postal Code</label><input type="text" id="id_cfa2_post_code" name="post_code" class="form-control" value="{{ cfa2_info.post_code|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_business_physical_address">Physical Address</label><input type="text" id="id_cfa2_business_physical_address" name="business_physical_address" class="form-control" value="{{ cfa2_info.business_physical_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa2_post_code2">Physical Code</label><input type="text" id="id_cfa2_post_code2" name="post_code2" class="form-control" value="{{ cfa2_info.post_code2|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CFA 2 Info</button>
                        </form>
                    </div>
                </section>

                <section id="cfa3" class="tab-pane">
                    <div id="cfa3-display">
                        <h2>CFA 3 Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa3-edit" data-parent-tab="cfa3" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if cfa3_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if cfa3_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ cfa3_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ cfa3_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ cfa3_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ cfa3_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ cfa3_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ cfa3_info.work_dial_code|default:"" }} {{ cfa3_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ cfa3_info.fax_dial_code|default:"" }} {{ cfa3_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ cfa3_info.mobile_number|default:"N/A" }}</td></tr>
                                <tr><th>Postal Address</th><td>{{ cfa3_info.business_postal_address|default:"N/A" }}</td></tr>
                                <tr><th>Postal Code</th><td>{{ cfa3_info.post_code|default:"N/A" }}</td></tr>
                                <tr><th>Physical Address</th><td>{{ cfa3_info.business_physical_address|default:"N/A" }}</td></tr>
                                <tr><th>Physical Code</th><td>{{ cfa3_info.post_code2|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No CFA 3 information available for this member. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="cfa3-edit" style="display: none;">
                        <h2>{% if cfa3_info %}Edit{% else %}Add{% endif %} CFA 3 Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="cfa3-display" data-parent-tab="cfa3" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_cfa3">
                           
                            <div class="form-group"><label for="id_cfa3_title">Title</label><input type="text" id="id_cfa3_title" name="title" class="form-control" value="{{ cfa3_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_first_name">First Name</label><input type="text" id="id_cfa3_first_name" name="first_name" class="form-control" value="{{ cfa3_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_surname">Surname</label><input type="text" id="id_cfa3_surname" name="surname" class="form-control" value="{{ cfa3_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_id_number">ID Number</label><input type="text" id="id_cfa3_id_number" name="id_number" class="form-control" value="{{ cfa3_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_email_address">E-mail</label><input type="email" id="id_cfa3_email_address" name="email_address" class="form-control" value="{{ cfa3_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <div class="form-group">
                                <label for="id_cfa3_work_contact_number">Work Number</label>
                                <input type="text" id="id_cfa3_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ cfa3_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa3_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ cfa3_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_cfa3_fax_number">Fax Number</label>
                                <input type="text" id="id_cfa3_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ cfa3_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_cfa3_fax_number" name="fax_number" placeholder="Number" value="{{ cfa3_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_cfa3_mobile_number">Mobile Number</label><input type="text" id="id_cfa3_mobile_number" name="mobile_number" class="form-control" value="{{ cfa3_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>

                            <div class="form-group"><label for="id_cfa3_business_postal_address">Postal Address</label><input type="text" id="id_cfa3_business_postal_address" name="business_postal_address" class="form-control" value="{{ cfa3_info.business_postal_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_post_code">Postal Code</label><input type="text" id="id_cfa3_post_code" name="post_code" class="form-control" value="{{ cfa3_info.post_code|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_business_physical_address">Physical Address</label><input type="text" id="id_cfa3_business_physical_address" name="business_physical_address" class="form-control" value="{{ cfa3_info.business_physical_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_cfa3_post_code2">Physical Code</label><input type="text" id="id_cfa3_post_code2" name="post_code2" class="form-control" value="{{ cfa3_info.post_code2|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save CFA 3 Info</button>
                        </form>
                    </div>
                </section>
               
                <section id="communications" class="tab-pane">
                    <div id="communications-display">
                        <h2>Communications Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="communications-edit" data-parent-tab="communications" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if communications_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if communications_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ communications_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ communications_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ communications_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ communications_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ communications_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ communications_info.work_dial_code|default:"" }} {{ communications_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ communications_info.fax_dial_code|default:"" }} {{ communications_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ communications_info.mobile_number|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No Communications Person information available. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="communications-edit" style="display: none;">
                        <h2>{% if communications_info %}Edit{% else %}Add{% endif %} Communications Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="communications-display" data-parent-tab="communications" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_communications">
                           
                            <div class="form-group"><label for="id_communications_title">Title</label><input type="text" id="id_communications_title" name="title" class="form-control" value="{{ communications_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_communications_first_name">First Name</label><input type="text" id="id_communications_first_name" name="first_name" class="form-control" value="{{ communications_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_communications_surname">Surname</label><input type="text" id="id_communications_surname" name="surname" class="form-control" value="{{ communications_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_communications_id_number">ID Number</label><input type="text" id="id_communications_id_number" name="id_number" class="form-control" value="{{ communications_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_communications_email_address">E-mail</label><input type="email" id="id_communications_email_address" name="email_address" class="form-control" value="{{ communications_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <div class="form-group">
                                <label for="id_communications_work_contact_number">Work Number</label>
                                <input type="text" id="id_communications_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ communications_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_communications_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ communications_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_communications_fax_number">Fax Number</label>
                                <input type="text" id="id_communications_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ communications_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_communications_fax_number" name="fax_number" placeholder="Number" value="{{ communications_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_communications_mobile_number">Mobile Number</label><input type="text" id="id_communications_mobile_number" name="mobile_number" class="form-control" value="{{ communications_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save Communications Info</button>
                        </form>
                    </div>
                </section>

                <section id="hr" class="tab-pane">
                    <div id="hr-display">
                        <h2>Human Resources Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="hr-edit" data-parent-tab="hr" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if hr_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if hr_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ hr_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ hr_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ hr_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ hr_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ hr_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Indemnity</th><td>{{ hr_info.indemnity|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ hr_info.work_dial_code|default:"" }} {{ hr_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ hr_info.fax_dial_code|default:"" }} {{ hr_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ hr_info.mobile_number|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No Human Resources information available. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="hr-edit" style="display: none;">
                        <h2>{% if hr_info %}Edit{% else %}Add{% endif %} Human Resources Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="hr-display" data-parent-tab="hr" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_hr">
                           
                            <div class="form-group"><label for="id_hr_title">Title</label><input type="text" id="id_hr_title" name="title" class="form-control" value="{{ hr_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_hr_first_name">First Name</label><input type="text" id="id_hr_first_name" name="first_name" class="form-control" value="{{ hr_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_hr_surname">Surname</label><input type="text" id="id_hr_surname" name="surname" class="form-control" value="{{ hr_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_hr_id_number">ID Number</label><input type="text" id="id_hr_id_number" name="id_number" class="form-control" value="{{ hr_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_hr_email_address">E-mail</label><input type="email" id="id_hr_email_address" name="email_address" class="form-control" value="{{ hr_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_hr_indemnity">Indemnity</label><input type="text" id="id_hr_indemnity" name="indemnity" class="form-control" value="{{ hr_info.indemnity|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <div class="form-group">
                                <label for="id_hr_work_contact_number">Work Number</label>
                                <input type="text" id="id_hr_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ hr_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_hr_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ hr_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_hr_fax_number">Fax Number</label>
                                <input type="text" id="id_hr_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ hr_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_hr_fax_number" name="fax_number" placeholder="Number" value="{{ hr_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_hr_mobile_number">Mobile Number</label><input type="text" id="id_hr_mobile_number" name="mobile_number" class="form-control" value="{{ hr_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save HR Info</button>
                        </form>
                    </div>
                </section>

                <section id="section13a" class="tab-pane">
                    <div id="section13a-display">
                        <h2>Section 13A Contact Details
                            <button class="btn btn-sm edit-toggle-btn" data-target="section13a-edit" data-parent-tab="section13a" style="margin-left: 10px; padding: 5px 10px; background-color: var(--color-light-green); border: 1px solid var(--color-primary); color: var(--color-text-dark);">
                                {% if section13a_info %}Edit{% else %}Add New{% endif %}
                            </button>
                        </h2>

                        {% if section13a_info %}
                        <table class="data-table">
                            <tbody>
                                <tr><th>Title</th><td>{{ section13a_info.title|default:"N/A" }}</td></tr>
                                <tr><th>First Name</th><td>{{ section13a_info.first_name|default:"N/A" }}</td></tr>
                                <tr><th>Surname</th><td>{{ section13a_info.surname|default:"N/A" }}</td></tr>
                                <tr><th>ID Number</th><td>{{ section13a_info.id_number|default:"N/A" }}</td></tr>
                                <tr><th>E-mail</th><td>{{ section13a_info.email_address|default:"N/A" }}</td></tr>
                                <tr><th>Indemnity</th><td>{{ section13a_info.indemnity|default:"N/A" }}</td></tr>
                                <tr><th>Work Number</th><td>{{ section13a_info.work_dial_code|default:"" }} {{ section13a_info.work_contact_number|default:"N/A" }}</td></tr>
                                <tr><th>Fax Number</th><td>{{ section13a_info.fax_dial_code|default:"" }} {{ section13a_info.fax_number|default:"N/A" }}</td></tr>
                                <tr><th>Mobile Number</th><td>{{ section13a_info.mobile_number|default:"N/A" }}</td></tr>
                            </tbody>
                        </table>
                        {% else %}
                        <p class="empty-message">No Section 13A information available. Click 'Add New' to create a record.</p>
                        {% endif %}
                    </div>

                    <div id="section13a-edit" style="display: none;">
                        <h2>{% if section13a_info %}Edit{% else %}Add{% endif %} Section 13A Contact
                            <button class="btn btn-sm edit-toggle-btn" data-target="section13a-display" data-parent-tab="section13a" style="margin-left: 10px; padding: 5px 10px; background-color: #f44336; color: white; border: 1px solid #d32f2f;">Cancel</button>
                        </h2>
                       
                        <form method="POST" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="update_section13a">
                           
                            <div class="form-group"><label for="id_section13a_title">Title</label><input type="text" id="id_section13a_title" name="title" class="form-control" value="{{ section13a_info.title|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_section13a_first_name">First Name</label><input type="text" id="id_section13a_first_name" name="first_name" class="form-control" value="{{ section13a_info.first_name|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_section13a_surname">Surname</label><input type="text" id="id_section13a_surname" name="surname" class="form-control" value="{{ section13a_info.surname|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_section13a_id_number">ID Number</label><input type="text" id="id_section13a_id_number" name="id_number" class="form-control" value="{{ section13a_info.id_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_section13a_email_address">E-mail</label><input type="email" id="id_section13a_email_address" name="email_address" class="form-control" value="{{ section13a_info.email_address|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                            <div class="form-group"><label for="id_section13a_indemnity">Indemnity</label><input type="text" id="id_section13a_indemnity" name="indemnity" class="form-control" value="{{ section13a_info.indemnity|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <div class="form-group">
                                <label for="id_section13a_work_contact_number">Work Number</label>
                                <input type="text" id="id_section13a_work_dial_code" name="work_dial_code" placeholder="Dial Code" value="{{ section13a_info.work_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_section13a_work_contact_number" name="work_contact_number" placeholder="Number" value="{{ section13a_info.work_contact_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group">
                                <label for="id_section13a_fax_number">Fax Number</label>
                                <input type="text" id="id_section13a_fax_dial_code" name="fax_dial_code" placeholder="Dial Code" value="{{ section13a_info.fax_dial_code|default:'' }}" style="width: 30%; padding: 8px; border: 1px solid #ccc; margin-right: 5px;">
                                <input type="text" id="id_section13a_fax_number" name="fax_number" placeholder="Number" value="{{ section13a_info.fax_number|default:'' }}" style="width: 65%; padding: 8px; border: 1px solid #ccc;">
                            </div>
                           
                            <div class="form-group"><label for="id_section13a_mobile_number">Mobile Number</label><input type="text" id="id_section13a_mobile_number" name="mobile_number" class="form-control" value="{{ section13a_info.mobile_number|default:'' }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;"></div>
                           
                            <button type="submit" class="btn btn-primary" style="background-color: var(--color-primary); color: white; padding: 10px 15px; border: none; cursor: pointer; margin-top: 15px;">Save Section 13A Info</button>
                        </form>
                    </div>
                </section>

<section id="email-log" class="tab-pane">
    <div class="content-section">
        <h2 style="color: #38761d; border-bottom: 2px solid #38761d; padding-bottom: 10px; margin-bottom: 20px;">
            Delegated Email Log for {{ contact_info.member_group_code }}
        </h2>
        
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background-color: white; font-size: 0.9em;">
                <thead>
                    <tr style="background-color: #f0fff0; color: #38761d; text-align: left;">
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Email Type</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Subject</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Received Date</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Delegated Date</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Assigned To</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Status</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581;">Actioned Date</th>
                        <th style="padding: 12px; border-bottom: 2px solid #aed581; text-align: center;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {# 1. DELEGATED LOG (ORIGINAL & REPLIES) #}
                    {% for email in combined_email_log %}
                    <tr style="border-bottom: 1px solid #eee; transition: background-color 0.2s; {% if email.status == 'Completed' %}background-color: #f9f9f9; color: #888;{% endif %}">
                        <td style="padding: 10px;">
                            {% if email.type == 'Original' %}
                                <span style="font-weight: bold; color: #1976d2;">üì• ORIGINAL</span>
                            {% else %}
                                <span style="font-weight: bold; color: #673ab7;">üì§ REPLY</span>
                            {% endif %}
                        </td>
                        <td style="padding: 10px;">
                            {% if email.status == 'Completed' %}
                                <span style="color: #666; font-weight: 500; cursor: not-allowed;" title="Thread is completed and locked">
                                    <i class="fas fa-lock" style="font-size: 0.8em; margin-right: 5px; color: #999;"></i> {{ email.subject|truncatechars:45 }}
                                </span>
                            {% else %}
                                <a href="{% url 'delegate_action' email_id=email.email_id %}?from=member" style="color: #2e7d32; text-decoration: none; font-weight: 500;">
                                    {{ email.subject|truncatechars:45 }}
                                </a>
                            {% endif %}
                        </td>
                        <td style="padding: 10px;">{{ email.arrival_timestamp|date:"Y-m-d H:i"|default:"-" }}</td>
                        <td style="padding: 10px;">{{ email.timestamp|date:"Y-m-d H:i"|default:email.delegation_timestamp|date:"Y-m-d H:i" }}</td>
                        <td style="padding: 10px;">{{ email.assigned_to }}</td>
                        <td style="padding: 10px;">
                            {% if email.status == 'Completed' %}
                                <span style="color: #388e3c; font-weight: bold;"><i class="fas fa-check-circle"></i> Actioned</span>
                            {% elif email.status == 'Delegated' %}
                                <span style="color: #1976d2; font-weight: bold;">Delegated</span>
                            {% else %}
                                <span style="color: #f57c00; font-weight: bold;">{{ email.status }}</span>
                            {% endif %}
                        </td>
                        <td style="padding: 10px;">
                            {% if email.status == 'Completed' %}
                                {{ email.timestamp|date:"Y-m-d H:i" }}
                            {% else %}-{% endif %}
                        </td>
                        <td style="padding: 10px; text-align: center;">
                            <div class="email-log-actions" style="display: flex; gap: 5px; justify-content: center;">
                                {# View Thread Button #}
                                {% if email.email_id %}
                                    <a href="{% url 'view_email_thread' email_id=email.email_id %}" class="action-btn bg-view" title="View Full Thread" style="background-color: #43a047; color: white; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.85em;">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                {% endif %}

                                {# DOWNLOAD BUTTON FOR ORIGINAL LOG - Uses email_id from the context map #}
                                {% if email.email_id %}
                                    <a href="?download_email_id={{ email.email_id }}" 
                                    class="action-btn bg-download" 
                                    title="Download Sent .eml">
                                        <i class="fas fa-download"></i> Download
                                    </a>
                                {% else %}
                                    <span style="color: #999; font-size: 0.85em; cursor: help;" title="Directly sent emails do not support downloads.">
                                        <i class="fas fa-ban"></i> No Download
                                    </span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" style="padding: 20px; text-align: center; color: #777;">No delegated communication found.</td>
                    </tr>
                    {% endfor %}

                    {# 2. DIRECT SENT EMAILS (STANDALONE LOG) #}
                    {% for email in direct_emails %}
                    <tr style="border-bottom: 1px solid #eee; background-color: #fafafa;">
                        <td style="padding: 10px;"><span style="font-weight: bold; color: #e91e63;">üì® DIRECT</span></td>
                        <td style="padding: 10px; color: #666;">{{ email.subject|truncatechars:45 }}</td>
                        <td style="padding: 10px;">-</td>
                        <td style="padding: 10px;">-</td>
                        <td style="padding: 10px;">{{ email.recipient_email }}</td>
                        <td style="padding: 10px;"><span style="color: #e91e63; font-weight: bold;">SENT</span></td>
                        <td style="padding: 10px;">{{ email.sent_at|date:"Y-m-d H:i" }}</td>
                        <td style="padding: 10px; text-align: center;">
                            <div class="email-log-actions" style="display: flex; gap: 5px; justify-content: center;">
                                {# View Thread Button #}
                                {% if email.outlook_message_id and email.outlook_message_id != "MANUAL_SEND_SUCCESS" %}
                                    <a href="{% url 'view_email_thread' email_id=email.outlook_message_id %}" class="action-btn bg-view" title="View Full Thread" style="background-color: #43a047; color: white; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.85em;">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                {% endif %}

                                {% if email.outlook_message_id %}
                                    <a href="?download_email_id={{ email.outlook_message_id }}" 
                                    class="action-btn bg-download" 
                                    title="Download Sent .eml">
                                        <i class="fas fa-download"></i> Download
                                    </a>
                                {% else %}
                                    <span style="color: #ccc;" title="No ID available for older logs">-</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<section id="compose-email" class="tab-pane">
    <form method="post" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}" id="compose_email_form" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="email-composition-area" style="background-color: #f8fbff; border: 1px solid #1e88e5; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            
            <h2 style="margin-top: 0; font-size: 1.4em; color: #1e88e5; display: flex; align-items: center; border-bottom: 2px solid #e3f2fd; padding-bottom: 10px; margin-bottom: 20px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16" style="margin-right: 10px;">
                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                </svg>
                Compose New Outgoing Email
            </h2>

            <input type="hidden" name="action" value="send_direct_email"> 
            <input type="hidden" name="email_body_html_content" id="direct_email_body_html_content">
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div class="form-group">
                    <label for="direct_member_recipient_email" style="font-weight: bold; display: block; margin-bottom: 5px; color: #333;">To:</label>
                    <input type="email" id="direct_member_recipient_email" name="recipient_email" 
                        placeholder="recipient@example.com"
                        value="{% if cbc_info.email_address %}{{ cbc_info.email_address }}{% endif %}"
                        required
                        style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 5px; box-sizing: border-box;">
                </div>
                <div class="form-group">
                    <label for="direct_member_cc_email" style="font-weight: bold; display: block; margin-bottom: 5px; color: #333;">Cc (Optional):</label>
                    <input type="text" id="direct_member_cc_email" name="cc_email" 
                        placeholder="comma separated emails"
                        style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 5px; box-sizing: border-box;">
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; display: block; margin-bottom: 5px; color: #333;">Action Log Type:</label>
                <select name="action_notes_email" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 5px; background-color: white;">
                    <option value="">Select Action Note</option>
                    <option value="Feedback to Sanlam">Feedback to Sanlam</option>
                    <option value="Feedback to Employer">Feedback to Employer</option>
                    <option value="Feedback to Member">Feedback to Member</option>
                    <option value="Feedback to CBC">Feedback to CBC</option>
                    <option value="Enquiry to FO">Enquiry to FO</option>
                    <option value="Enquiry to Sanlam">Enquiry to Sanlam</option>
                    <option value="Enquiry to Employer">Enquiry to Employer</option>
                    <option value="Enquiry to CBC">Enquiry to CBC</option>
                    <option value="Sent to Employer">Sent to Employer</option>
                    <option value="Sent to Sanlam">Sent to Sanlam</option>
                    <option value="Sent to CBC">Sent to CBC</option>
                    <option value="Sent to FO">Sent to FO</option>
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 15px;">
                <label for="direct_member_email_subject" style="font-weight: bold; display: block; margin-bottom: 5px; color: #333;">Subject:</label>
                <input type="text" id="direct_member_email_subject" name="subject" 
                    value="[MIP: {{ contact_info.member_group_code }}] New Direct Communication"
                    required
                    style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 5px; box-sizing: border-box; font-weight: 500;">
            </div>

            <div style="background: #eee; border: 1px solid #cbd5e0; border-bottom: none; padding: 5px 10px; border-radius: 5px 5px 0 0; display: flex; gap: 10px;">
                <button type="button" onclick="document.execCommand('bold', false, null)" style="cursor:pointer; font-weight:bold; border:1px solid #ccc; background:#fff; padding:2px 8px;">B</button>
                <button type="button" onclick="document.execCommand('italic', false, null)" style="cursor:pointer; font-style:italic; border:1px solid #ccc; background:#fff; padding:2px 8px;">I</button>
                <button type="button" onclick="document.execCommand('underline', false, null)" style="cursor:pointer; text-decoration:underline; border:1px solid #ccc; background:#fff; padding:2px 8px;">U</button>
                <button type="button" onclick="document.execCommand('insertUnorderedList', false, null)" style="cursor:pointer; border:1px solid #ccc; background:#fff; padding:2px 8px;">‚Ä¢ List</button>
            </div>

            <div class="form-group" style="margin-bottom: 15px;">
                <div id="direct_member_email_body_editor" 
                    class="rich-text-editor" 
                    contenteditable="true"
                    style="min-height: 250px; border: 1px solid #cbd5e0; border-radius: 0 0 5px 5px; padding: 15px; background: #fff; line-height: 1.6; outline: none; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);">
                    <p>Dear Sir/Madam,</p>
                    <p>Regarding Member Group Code <strong>{{ contact_info.member_group_code }}</strong>,</p>
                    <p><br></p>
                    <p>Kind regards,</p>
                    <p><strong>{{ request.user.username }}</strong></p>
                </div>
            </div>
            
            <div class="form-group" style="margin-bottom: 20px;">
                <label for="attachments" style="font-weight: bold; display: block; margin-bottom: 5px; color: #333;">Attachments:</label>
                <div class="file-upload-wrapper" style="padding: 15px; border: 2px dashed #1e88e5; border-radius: 6px; background-color: #fff; text-align: center;">
                    <input type="file" id="direct_attachments" name="attachments" multiple style="cursor: pointer;">
                    <p style="margin: 8px 0 0 0; color: #666; font-size: 12px;">Files attached here will be sent to the recipient and logged in the MIP system.</p>
                </div>
            </div>

            <button type="submit" 
                    name="email_submission_action"
                    value="send_email_and_log"
                    id="direct_email_submit"
                    style="width: 100%; background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%); color: white; border: none; padding: 14px; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: background 0.2s;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-send-check-fill" viewBox="0 0 16 16" style="margin-right: 10px;">
                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887L.95 7.02a.5.5 0 0 0 .1.1L15.964.686Zm-5.833 7.84L9.088 1.488 2.053 8.525l.812.324L10.131 8.525Z"/>
                </svg>
                Send Email and Update Log
            </button>
        </div>
    </form>
</section>
                <!-- END NEW SECTION -->


<section id="notes" class="tab-pane">
    <style>
        .dialer-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .dialer-btn {
            padding: 15px;
            font-size: 1.5em;
            font-weight: bold;
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.1s;
            width: 100%;
            height: 60px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .dialer-btn:hover {
            background-color: #e0e0e0;
        }
        .note-attachment-box {
            margin-top: 10px;
            padding: 8px;
            border: 1px dashed #43a047;
            border-radius: 4px;
            background-color: #fff;
            font-size: 0.9em;
        }
        .attachment-link {
            display: inline-block;
            margin-top: 5px;
            color: #1e88e5;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.85em;
        }
        .attachment-link:hover { text-decoration: underline; }
        
        /* Specific styling for the Email Link card */
        .email-link-card {
            background-color: #e3f2fd; 
            padding: 15px; 
            border-radius: 8px; 
            border: 1px solid #1e88e5;
        }
    </style>

    <div class="content-section">
        <form method="post" action="{% url 'member_information' member_group_code=contact_info.member_group_code %}#notes" id="notes_master_form" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="action" id="notes_form_action" value="save_member_note">
            
            <div class="row" style="display: flex; gap: 15px;">

                <div class="col-left" style="flex: 2; min-width: 300px;">
                    
                    <div class="row" style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div class="col-md-6" style="flex: 1;">
                            <div class="card card-notes-select" style="background-color: #e6ffe6; padding: 15px; border-radius: 8px;">
                                <label for="id_communication_type" style="font-weight: bold; display: block; margin-bottom: 5px; color: #38761d;">Communication Type:</label>
                                <select id="id_communication_type" name="communication_type" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                                    <option value="" disabled selected>Select Communication Type</option>
                                    <option value="Incoming Call">üìû Incoming Call</option>
                                    <option value="Outgoing Call">‚òéÔ∏è Outgoing Call</option>
                                    <option value="Notes Log">üìù Notes Log</option>
                                    <option value="Teams Meeting">üìù Teams Meeting</option>
                                    <option value="Sent E-mail">üìß Sent E-mail</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6" id="email-attach-section" style="flex: 1; display: none;">
                            <div class="email-link-card">
                                <label for="email_list_select" style="font-weight: bold; display: block; margin-bottom: 5px; color: #1565c0;">Reference Delegated Email:</label>
                                <input type="hidden" name="attached_email_id" id="attached_email_id">
                                <select id="email_list_select" style="width: 100%; padding: 8px; border: 1px solid #90caf9; border-radius: 4px;">
                                    <option value="">-- Select Email to Link --</option>
                                    {% for email in combined_email_log %}
                                        <option value="{{ email.email_id }}">{{ email.timestamp|date:"d M" }} - {{ email.subject|truncatechars:30 }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-6" id="action-notes-container" style="flex: 1;">
                            <div class="card card-notes-select" style="background-color: #e6ffe6; padding: 15px; border-radius: 8px;">
                                <label for="id_action_notes" style="font-weight: bold; display: block; margin-bottom: 5px; color: #38761d;">Action Notes:</label>
                                <select id="id_action_notes" name="action_notes" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="" disabled selected>Select Action Note</option>
                                    <option value="Feedback to Sanlam">Feedback to Sanlam</option>
                                    <option value="Feedback to Employer">Feedback to Employer</option>
                                    <option value="Feedback to Member">Feedback to Member</option>
                                    <option value="Feedback to CBC">Feedback to CBC</option>
                                    <option value="Enquiry to FO">Enquiry to FO</option>
                                    <option value="Enquiry to Sanlam">Enquiry to Sanlam</option>
                                    <option value="Enquiry to Employer">Enquiry to Employer</option>
                                    <option value="Enquiry to CBC">Enquiry to CBC</option>
                                    <option value="Sent to Employer">Sent to Employer</option>
                                    <option value="Sent to Sanlam">Sent to Sanlam</option>
                                    <option value="Sent to CBC">Sent to CBC</option>
                                    <option value="Sent to FO">Sent to FO</option>
                                </select>
                            </div>
                        </div>
                    </div> 

                    <div class="add-note-form-section" id="regular-note-area" style="background-color: #e6ffe6; padding: 15px; border-radius: 8px;">
                        <h2 style="margin-top: 0; font-size: 1.5em; color: #38761d;">Add New Note</h2>
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            <div style="display: flex; gap: 5px; align-items: stretch;">
                                <textarea name="note_content" 
                                          id="regular_note_content" 
                                          placeholder="Type your note here..." 
                                          style="flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; min-height: 80px;"></textarea>
                                <button type="submit" 
                                        name="note_submission_action"
                                        value="save_member_note"
                                        id="regular_note_submit"
                                        style="padding: 8px 12px; white-space: nowrap; background-color: #43a047; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    Add Note
                                </button>
                            </div>
                            <div class="note-attachment-box">
                                <label style="font-weight: bold; color: #38761d;">üìé Attach PDF/Document:</label>
                                <input type="file" name="note_file" id="note_file" accept=".pdf,.doc,.docx,.jpg,.png" style="margin-left: 10px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="dialer-area" id="dialer-area" style="display: none; margin-top: 15px; padding: 15px; border: 2px dashed #38761d; border-radius: 8px; background-color: #f0fff0;">
                        <h2 style="color: #38761d; margin-top: 0; font-size: 1.5em; display: flex; align-items: center;">
                            ‚òéÔ∏è Outgoing Call Dialer
                        </h2>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group" style="flex: 1;">
                                <label for="dialer_number" style="font-weight: bold; display: block; margin-bottom: 5px;">Number to Dial:</label>
                                <input type="text" id="dialer_number" name="dialer_number" placeholder="Mobile or Work Number" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="call_status" style="font-weight: bold; display: block; margin-bottom: 5px;">Call Status:</label>
                                <select id="call_status" name="call_status" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="" selected>Select Outcome</option>
                                    <option value="Completed - Success">Completed - Success</option>
                                    <option value="Completed - No Answer">Completed - No Answer</option>
                                </select>
                            </div>
                        </div>
                        <div class="dialer-pad-container" style="max-width: 300px; margin: 0 auto 20px;">
                            <div class="dialer-grid">
                                <button type="button" class="dialer-btn" data-number="1">1</button>
                                <button type="button" class="dialer-btn" data-number="2">2</button>
                                <button type="button" class="dialer-btn" data-number="3">3</button>
                                <button type="button" class="dialer-btn" data-number="4">4</button>
                                <button type="button" class="dialer-btn" data-number="5">5</button>
                                <button type="button" class="dialer-btn" data-number="6">6</button>
                                <button type="button" class="dialer-btn" data-number="7">7</button>
                                <button type="button" class="dialer-btn" data-number="8">8</button>
                                <button type="button" class="dialer-btn" data-number="9">9</button>
                                <button type="button" class="dialer-btn dialer-symbol" data-number="*">*</button>
                                <button type="button" class="dialer-btn" data-number="0">0</button>
                                <button type="button" class="dialer-btn dialer-symbol" data-number="#">#</button>
                            </div>
                            <button type="button" id="dialer_clear" style="width: 100%; padding: 5px; margin-top: 10px; background-color: #f44336; color: white; border: none; border-radius: 4px;">Clear</button>
                        </div>
                        <button type="button" id="trigger_call_dialer" style="width: 100%; padding: 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; font-weight: bold;">üìû Dial Number</button>
                    </div>
                </div>
                
            <div class="col-right existing-notes-list" style="flex: 1; padding: 15px; background-color: #e6ffe6; border-radius: 8px;">
                <h2 style="margin-top: 0; font-size: 1.5em; color: #38761d;">Existing Notes</h2>
                <div class="note-list" style="max-height: 400px; overflow-y: auto;">
                    {% if notes %}
                        {% for note in notes %}
                        <div class="note-item" style="border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; position: relative;">
                            <div class="note-header" style="font-size: 0.9em; margin-bottom: 5px;">
                                Posted by: <strong>{{ note.user }}</strong> on {{ note.date|date:"Y-m-d H:i" }}
                                <small style="display: block; color: #555;">{{ note.communication_type }} | {{ note.action_notes }}</small>
                            </div>
                            <p class="note-content" style="margin-top: 5px; margin-bottom: 0;">{{ note.notes }}</p>
                            
                            {# Check for the filename field added to the ClientNotes model #}
                            {% if note.attached_file_name %}
                                <div style="margin-top: 8px;">
                                    <a href="{% url 'download_member_note_file' member_group_code=contact_info.member_group_code %}?file={{ note.attached_file_name }}" 
                                    class="attachment-link" 
                                    style="display: inline-flex; align-items: center; background-color: #f1f8e9; border: 1px solid #c8e6c9; padding: 4px 8px; border-radius: 4px; color: #2e7d32; text-decoration: none; font-size: 0.85em; font-weight: bold;">
                                        <i class="fas fa-paperclip" style="margin-right: 5px;"></i> View Attachment
                                    </a>
                                    <small style="color: #666; font-size: 0.75em; display: block; margin-top: 2px;">
                                        {{ note.attached_file_name|truncatechars:30 }}
                                    </small>
                                </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="empty-message">No notes available.</p>
                    {% endif %}
                </div>
            </div>

            <button type="submit" name="note_submission_action" value="save_member_note" id="call_note_submit" style="width: 100%; background-color: #4CAF50; color: white; border: none; padding: 10px; border-radius: 4px; display: none; margin-top: 15px;">Log Outgoing Call Note</button>
        </form>
    </div>
</section>
               
<section id="pdf-documents" class="tab-pane">
    <div class="content-section">
        <div class="pdf-upload-section" style="background-color: #e6ffe6; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h2 style="color: #38761d; margin-top: 0;">Upload New Document (PDF)</h2>
            <form method="post" enctype="multipart/form-data" 
                  action="{% url 'member_information' member_group_code=contact_info.member_group_code %}#pdf-documents"
                  class="pdf-upload-form" id="pdf_upload_master">
                {% csrf_token %}
                
                <input type="hidden" name="action" value="upload_pdf"> 
                
                <div class="form-row" style="margin-bottom: 15px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Document Title:</label>
                    <select name="title" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" required>
                        <option value="" selected disabled>Select Fica Document Type</option>
                        <option value="Fica_1">ID Document</option> 
                        <option value="Fica_2">Proof of Address</option>
                        <option value="Fica_3">Bank Statement</option>
                        <option value="Fica_4">Appointment Letter</option>
                        <option value="Fica_5">VAT Number</option>
                        <option value="Fica_6">Mandate/Trust Deed</option>
                        <option value="Fica_7">Tax Number</option>
                    </select>
                </div>

                <div class="form-row" style="margin-bottom: 15px;">
                    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Select PDF File:</label>
                    <input type="file" name="pdf_file" accept=".pdf" required
                           style="background: white; padding: 5px; border: 1px dashed #43a047; border-radius: 4px; width: 100%;">
                </div>
                
                <button type="submit" class="pdf-upload-button" 
                        style="padding: 10px 20px; background-color: #38761d; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                    Upload Document
                </button>
            </form>
        </div>
        
        <div class="document-list-section">
            <h2 style="color: #38761d;">Existing Documents</h2>
            {% if documents %}
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f0fff0;">
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #aed581;">File Name</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #aed581;">Title</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #aed581;">Uploaded By</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #aed581;">Date</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #aed581;">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for doc in documents %}
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 10px;">{{ doc.document_file.name|default:"N/A"|slice:"50" }}</td>
                            <td style="padding: 10px;">{{ doc.title }}</td>
                            <td style="padding: 10px;">{{ doc.uploaded_by }}</td>
                            <td style="padding: 10px;">{{ doc.uploaded_at|date:"Y-m-d H:i" }}</td>
                            <td style="padding: 10px;">
                                <a href="{% url 'member_information' member_group_code=contact_info.member_group_code %}?download_id={{ doc.id }}" 
                                   style="color: #1e88e5; text-decoration: none; font-weight: bold;">
                                    Download
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="empty-message" style="text-align: center; color: #777; font-style: italic; padding: 20px;">
                    No documents have been uploaded for this member yet.
                </p>
            {% endif %}
        </div>
    </div>
</section>
       
<script>
    // --- NO TIMER FUNCTIONS ARE INCLUDED IN THIS SCRIPT ---

    // --- Tab Switching Logic (Unmodified) ---
    const toggleEditView = (currentSectionId, targetSectionId) => {
        const currentDiv = document.getElementById(currentSectionId);
        const targetDiv = document.getElementById(targetSectionId);

        if (currentDiv) currentDiv.style.display = 'none';
        if (targetDiv) targetDiv.style.display = 'block';
    };

    document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('.tab-nav li');
        const panes = document.querySelectorAll('.tab-pane');

        const activateTab = (tabElement) => {
            const targetId = tabElement.dataset.tabTarget;
            const targetPane = document.querySelector(targetId);

            if (targetPane) {
                tabs.forEach(t => t.classList.remove('active'));
                panes.forEach(p => p.classList.remove('active'));

                tabElement.classList.add('active');
                targetPane.classList.add('active');
            }
        };

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                activateTab(tab);
                // This updates the URL so if the user hits 'Refresh' or 'Submit', 
                // the server knows which tab to stay on.
                const targetHash = tab.dataset.tabTarget;
                window.history.replaceState(null, null, targetHash);
            });
        });

        document.querySelectorAll('.edit-toggle-btn').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const parentTabId = this.getAttribute('data-parent-tab');

                let currentId;
                if (targetId.endsWith('-edit')) {
                    currentId = parentTabId + '-display'; 
                } else {
                    currentId = parentTabId + '-edit'; 
                }
                toggleEditView(currentId, targetId);
            });
        });

        // ====================================================================
        // === UPDATED INITIAL TAB SELECTION (FIXES SCROLL JUMP) ===
        // ====================================================================
        const urlParams = new URLSearchParams(window.location.search);
        const activateEditMode = urlParams.get('edit_mode');
        const hash = window.location.hash;
        
        let initialTab = null;
        let editDivId = null;

        if (activateEditMode === 'general_info') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#general-info"]');
            editDivId = 'general-info-edit';
        } else if (activateEditMode === 'cbc') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cbc"]');
            editDivId = 'cbc-edit';
        } else if (activateEditMode === 'cbc_admin') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cbc-admin"]');
            editDivId = 'cbc-admin-edit';
        } else if (activateEditMode === 'cbc_consultancy') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cbc-consultancy"]');
            editDivId = 'cbc-consultancy-edit';
        } else if (activateEditMode === 'cfa') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cfa"]');
            editDivId = 'cfa-edit';
        } else if (activateEditMode === 'cfa-admin') { 
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cfa-admin"]');
            editDivId = 'cfa-admin-edit';
        } else if (activateEditMode === 'cfa2') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cfa2"]');
            editDivId = 'cfa2-edit';
        } else if (activateEditMode === 'cfa3') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#cfa3"]');
            editDivId = 'cfa3-edit';
        } else if (activateEditMode === 'communications') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#communications"]');
            editDivId = 'communications-edit';
        } else if (activateEditMode === 'hr') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#hr"]');
            editDivId = 'hr-edit';
        } else if (activateEditMode === 'section13a') {
            initialTab = document.querySelector('.tab-nav li[data-tab-target="#section13a"]');
            editDivId = 'section13a-edit';
        } else if (hash) {
            // Prioritize hash (e.g., #pdf-documents) for form redirects
            initialTab = document.querySelector(`.tab-nav li[data-tab-target="${hash}"]`);
        }
        
        if (initialTab) {
            activateTab(initialTab);

            // Added: Forces page to stay at the top after tab activation
            if (hash) {
                setTimeout(() => {
                    window.scrollTo(0, 0); 
                    const tabContent = document.querySelector('.tab-content');
                    if (tabContent) tabContent.scrollTop = 0;
                }, 10);
            }

            if (editDivId) {
                const displayDivId = editDivId.replace('-edit', '-display');
                toggleEditView(displayDivId, editDivId); 
            }
        } else {
            activateTab(document.querySelector('.tab-nav li.active'));
        }

        // ====================================================================
        // === ATTACHMENT CLICK HANDLER (UPDATED FOR DOWNLOAD SUPPORT) ===
        // ====================================================================
        document.querySelectorAll('.attachment-link').forEach(link => {
            link.addEventListener('click', function() {
                const originalContent = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Downloading...';
                
                // We no longer set pointerEvents to 'none' because it can interfere 
                // with the browser initiating the download stream from Django.
                this.style.opacity = '0.7';
                
                setTimeout(() => {
                    this.innerHTML = originalContent;
                    this.style.opacity = '1';
                }, 3000); // Extended slightly to allow the download to start
            });
        });

        // ====================================================================
        // === NOTES TAB DYNAMIC COMMUNICATION FORM VISIBILITY AND DIALER LOGIC (Unmodified) ===
        // ====================================================================
        const commTypeSelect = document.getElementById('id_communication_type');
        const regularNoteArea = document.getElementById('regular-note-area');
        const dialerArea = document.getElementById('dialer-area');
        const emailAttachSection = document.getElementById('email-attach-section');
        const callLogSubmit = document.getElementById('call_note_submit');
        const notesMasterForm = document.getElementById('notes_master_form');
        
        const dialButton = document.getElementById('trigger_call_dialer');

        const regularNoteContent = document.getElementById('regular_note_content'); 
        const regularNoteSubmit = document.getElementById('regular_note_submit'); 
        const dialerNumber = document.getElementById('dialer_number');
        const callStatus = document.getElementById('call_status');
        
        const attachedEmailIdInput = document.getElementById('attached_email_id');
        const emailListSelect = document.getElementById('email_list_select');
       
        const dialerButtons = document.querySelectorAll('.dialer-btn');
        const dialerClear = document.getElementById('dialer_clear');

        function appendNumber(value) {
            if (dialerNumber) {
                dialerNumber.value += value;
            }
        }
       
        dialerButtons.forEach(button => {
            button.addEventListener('click', () => {
                const number = button.getAttribute('data-number');
                appendNumber(number);
            });
        });
       
        if (dialerClear) {
            dialerClear.addEventListener('click', () => {
                if (dialerNumber) {
                    dialerNumber.value = dialerNumber.value.slice(0, -1);
                }
            });
        }

        function toggleCommunicationForms() {
            if (!commTypeSelect) return;
            const selectedValue = commTypeSelect.value;
           
            if (regularNoteArea) regularNoteArea.style.display = 'none';
            if (dialerArea) dialerArea.style.display = 'none';
            if (emailAttachSection) emailAttachSection.style.display = 'none';
            if (callLogSubmit) callLogSubmit.style.display = 'none';

            if (regularNoteContent) {
                regularNoteContent.value = '';
                regularNoteContent.removeAttribute('required'); 
                regularNoteContent.removeAttribute('disabled');
            }
            if (regularNoteSubmit) {
                regularNoteSubmit.removeAttribute('name');
                regularNoteSubmit.removeAttribute('disabled');
            }
            if (dialerNumber) dialerNumber.removeAttribute('required');
            if (callStatus) callStatus.removeAttribute('required');
            
            if (emailListSelect) emailListSelect.value = '';
            if (attachedEmailIdInput) attachedEmailIdInput.value = '';

            if (selectedValue === 'Outgoing Call') {
                if (dialerArea) dialerArea.style.display = 'block';
                if (regularNoteArea) regularNoteArea.style.display = 'block';
                if (callLogSubmit) callLogSubmit.style.display = 'block';
                if (dialerNumber) dialerNumber.setAttribute('required', 'required');
                if (regularNoteSubmit) regularNoteSubmit.setAttribute('disabled', 'true');
            } else if (selectedValue === 'Sent E-mail') {
                if (regularNoteArea) regularNoteArea.style.display = 'block';
                if (emailAttachSection) emailAttachSection.style.display = 'block';
                if (regularNoteSubmit) regularNoteSubmit.setAttribute('name', 'note_submission_action');
            } else if (['Incoming Call', 'Notes Log', 'Teams Meeting'].includes(selectedValue)) {
                if (regularNoteArea) regularNoteArea.style.display = 'block';
                if (regularNoteContent) regularNoteContent.setAttribute('required', 'required');
                if (regularNoteSubmit) regularNoteSubmit.setAttribute('name', 'note_submission_action');
            } else {
                if (regularNoteArea) regularNoteArea.style.display = 'block';
                if (regularNoteSubmit) regularNoteSubmit.setAttribute('name', 'note_submission_action');
            }
        }
       
        if (commTypeSelect) {
            commTypeSelect.addEventListener('change', toggleCommunicationForms);
        }

        if (emailListSelect && attachedEmailIdInput) {
            emailListSelect.addEventListener('change', function() {
                attachedEmailIdInput.value = this.value;
            });
        }
       
        if (dialButton) {
            dialButton.addEventListener('click', function() {
                const phoneNumber = dialerNumber ? dialerNumber.value.trim() : '';
                if (phoneNumber === '') {
                    console.error('Please enter the Number to Dial.');
                    return;
                }
                window.location.href = 'tel:' + phoneNumber.replace(/[^0-9+]/g, ''); 
            });
        }

        if (commTypeSelect) {
            toggleCommunicationForms();
        }
       
        if (notesMasterForm) {
            notesMasterForm.addEventListener('submit', function(event) {
                const selectedType = commTypeSelect ? commTypeSelect.value : '';
                const isCallLog = selectedType === 'Outgoing Call';

                if (isCallLog) {
                    if (dialerNumber && dialerNumber.value.trim() === '') {
                         console.error('The Number to Dial is required to log a call.');
                         event.preventDefault();
                         return;
                    }
                } else if (regularNoteArea && regularNoteArea.style.display === 'block') {
                    if (regularNoteContent && regularNoteContent.hasAttribute('required') && regularNoteContent.value.trim() === '') {
                        console.error('Note content is required for a log entry.');
                        event.preventDefault();
                    }
                }
            });
        }
        
        // ====================================================================
        // === COMPOSE EMAIL TAB LOGIC (Unmodified) ===
        // ====================================================================
        const composeEmailForm = document.getElementById('compose_email_form');
        const directEmailBodyEditor = document.getElementById('direct_member_email_body_editor');
        const directEmailBodyHtmlInput = document.getElementById('direct_email_body_html_content');
        const directEmailActionInput = composeEmailForm ? composeEmailForm.querySelector('input[name="action"]') : null;
        const sendEmailButton = composeEmailForm ? composeEmailForm.querySelector('button[type="submit"]') : null;

        if (composeEmailForm) {
            composeEmailForm.addEventListener('submit', function(event) {
                if (directEmailBodyEditor && directEmailBodyHtmlInput) {
                    const content = directEmailBodyEditor.innerHTML.trim();
                    if (!content || directEmailBodyEditor.innerText.trim() === '') {
                        console.error('Email body cannot be empty.');
                        event.preventDefault();
                        return;
                    }
                    directEmailBodyHtmlInput.value = content;
                }
                
                if (directEmailActionInput) {
                     directEmailActionInput.value = 'send_direct_email';
                }

                if (sendEmailButton) {
                    sendEmailButton.innerHTML = '<i class="fas fa-paper-plane fa-spin"></i> Sending via Outlook...';
                    sendEmailButton.style.opacity = '0.7';
                    sendEmailButton.style.pointerEvents = 'none';
                }
            });
        }
    });
</script>
</body>
</html>