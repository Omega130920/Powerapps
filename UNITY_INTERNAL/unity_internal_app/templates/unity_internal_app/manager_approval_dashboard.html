{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Approval Dashboard | Unity Internal</title>
    <style>
        /* Matches your main dashboard background */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(to bottom, #d1e2c4, rgb(143, 207, 127)); 
            min-height: 100vh;
            margin: 0;
            padding: 20px; 
            box-sizing: border-box;
        }

        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); 
        }

        /* Unity Green Header */
        h2 { 
            color: #1b5e20; 
            border-bottom: 2px solid #aed581; 
            padding-bottom: 10px; 
            margin-top: 0;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }

        /* Green Table Header Theme */
        th { 
            background: #f1f8e9; 
            padding: 12px; 
            text-align: left; 
            color: #2e7d32; 
            font-size: 0.9em; 
            text-transform: uppercase; 
            border-bottom: 2px solid #aed581;
        }

        td { 
            padding: 12px; 
            border-bottom: 1px solid #eee; 
            vertical-align: middle; 
            font-size: 0.95em;
        }

        /* Success Green Button */
        .btn-approve { 
            background: #81c784; 
            color: white; 
            padding: 8px 15px; 
            text-decoration: none; 
            border-radius: 4px; 
            font-weight: bold; 
            font-size: 0.85em;
            display: inline-block;
            transition: background 0.3s;
        }
        .btn-approve:hover { background: #66bb6a; }

        /* Danger Red Button */
        .btn-reject { 
            background: #d32f2f; 
            color: white; 
            padding: 8px 15px; 
            text-decoration: none; 
            border-radius: 4px; 
            font-weight: bold; 
            font-size: 0.85em;
            display: inline-block;
            transition: background 0.3s;
        }
        .btn-reject:hover { background: #b71c1c; }
        
        /* Styled Reason Box */
        .reason-box { 
            background: #fafafa; 
            padding: 10px; 
            border-left: 4px solid #81c784; 
            font-size: 0.9em; 
            border-radius: 2px; 
            color: #444; 
            font-style: italic; 
        }

        .amount-tag { font-weight: bold; color: #2e7d32; }
        
        .partial-flag { 
            font-size: 0.75em; 
            background: #e8f5e9; 
            color: #2e7d32; 
            padding: 2px 5px; 
            border-radius: 3px; 
            margin-left: 5px; 
            border: 1px solid #c8e6c9;
        }

        .back-link {
            text-decoration: none; 
            color: #1b5e20; 
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üõ°Ô∏è Credit Link Approvals</h2>
        <p>There are <strong>{{ pending_credits.count }}</strong> requests awaiting your authorization.</p>
        
        <table>
            <thead>
                <tr>
                    <th>Date Requested</th>
                    <th>Group Code</th>
                    <th>Requested Allocation</th>
                    <th>Target Bill</th>
                    <th>Requester's Reason</th>
                    <th style="text-align: center;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for credit in pending_credits %}
                <tr>
                    <td>{{ credit.processed_date|date:"Y-m-d" }}</td>
                    <td><strong style="color: #2e7d32;">{{ credit.member_group_code }}</strong></td>
                    <td>
                        <span class="amount-tag">R {{ credit.requested_amount|default:credit.schedule_amount|floatformat:2 }}</span>
                        {% if credit.requested_amount < credit.schedule_amount and credit.requested_amount > 0 %}
                            <span class="partial-flag">Partial</span>
                        {% endif %}
                        <br><small style="color: #888;">Note Balance: R {{ credit.schedule_amount|floatformat:2 }}</small>
                    </td>
                    <td>
                        {% if credit.pending_linked_bill %}
                            <strong>Bill #{{ credit.pending_linked_bill.id }}</strong><br>
                            <small>{{ credit.pending_linked_bill.A_CCDatesMonth|date:"M Y" }}</small>
                        {% else %}
                            <span style="color:#d32f2f; font-weight: bold;">No Bill Selected</span>
                        {% endif %}
                    </td>
                    <td style="width: 25%;">
                        <div class="reason-box">
                            "{{ credit.link_request_reason|default:'No reason provided.' }}"
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            <a href="{% url 'approve_credit_link' credit.id %}" class="btn-approve">‚úÖ Approve</a>
                            <a href="{% url 'reject_credit_link' credit.id %}" 
                               class="btn-reject" 
                               onclick="return confirm('Are you sure you want to REJECT this link request? The credit will be returned to the available pool.')">
                                ‚ùå Reject
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 60px; color: #666;">
                        <span style="font-size: 3rem; opacity: 0.5;">‚úÖ</span><br><br>
                        No pending approvals found. All systems are up to date!
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
            <a href="{% url 'dashboard' %}" class="back-link">‚Üê Back to Main Dashboard</a>
        </div>
    </div>
</body>
</html>