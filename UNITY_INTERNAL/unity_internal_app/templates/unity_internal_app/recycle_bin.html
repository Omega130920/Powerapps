<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recycle Bin | Unity Internal</title>
<style>
/* -------------------------------------- */
/* BASE STYLES */
/* -------------------------------------- */
body {
    font-family: sans-serif;
    background: linear-gradient(to bottom, #d1e2c4, rgb(143, 207, 127));
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    box-sizing: border-box;
}

.log-container {
    width: 100%;
    max-width: 1300px;
    margin: 40px auto;
    padding: 30px;
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.log-header {
    border-bottom: 2px solid #aed581;
    padding-bottom: 15px;
    margin-bottom: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.log-header h1 {
    margin: 0;
    color: #d32f2f; /* Red for Recycle Bin */
}

/* -------------------------------------- */
/* TABLE STYLES */
/* -------------------------------------- */
.task-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.task-table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #aed581;
    padding: 12px 15px;
    text-align: left;
    color: #333;
    text-transform: uppercase;
    font-size: 13px;
}

.task-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
}

.task-table tr.data-row:hover {
    background-color: #fff5f5; /* Light red hover */
    cursor: pointer;
}

/* -------------------------------------- */
/* CONTROLS & BUTTONS */
/* -------------------------------------- */
#search_input {
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 250px;
}

.btn-delete-selected {
    padding: 8px 15px;
    background-color: #d32f2f;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}

.btn-delete-selected:disabled {
    background-color: #ef9a9a;
    cursor: not-allowed;
}

.btn-restore {
    background-color: #e8f5e9;
    color: #2e7d32;
    padding: 6px 12px;
    border-radius: 4px;
    text-decoration: none;
    font-weight: bold;
    font-size: 12px;
}

.btn-restore:hover {
    background-color: #2e7d32;
    color: white;
}

.return-button {
    padding: 10px 20px;
    background-color: #757575;
    border-radius: 5px;
    text-decoration: none;
    color: white;
    font-weight: 500;
    margin-right: 10px;
}
</style>
</head>
<body>

    <div style="margin-top: 20px;">
        <a href="{% url 'dashboard' %}" class="return-button">Return to Home Screen</a>
    </div>

<div class="log-container">
    <div class="log-header">
        <h1>üóëÔ∏è Internal Recycle Bin</h1>
        <div style="display: flex; gap: 15px; align-items: center;">
            <input type="text" id="search_input" placeholder="üîç Search archived items...">
            <form method="POST" action="{% url 'outlook_delete_permanent' %}" id="delete_form">
                {% csrf_token %}
                <button type="submit" id="delete_btn" class="btn-delete-selected" disabled>
                    üóëÔ∏è Delete Selected
                </button>
            </form>
        </div>
    </div>
    
    {% if recycled_tasks %}
<table class="task-table">
    <thead>
        <tr>
            <th style="width: 40px;"><input type="checkbox" id="select_all"></th>
            <th style="width: 45%;">Subject</th> <th>Company Code</th>
            <th>Classification</th>
            <th style="text-align: center;">Actions</th>
        </tr>
    </thead>
    <tbody id="table_body">
        {% for task in recycled_tasks %}
        <tr class="data-row">
            <td onclick="event.stopPropagation();">
                <input type="checkbox" name="email_ids" value="{{ task.email_id }}" form="delete_form" class="delete-checkbox">
            </td>
            
            <td onclick="window.location.href='{% url 'outlook_delegated_action' delegation_id=task.pk %}';">
                <a href="{% url 'outlook_delegated_action' delegation_id=task.pk %}" style="text-decoration: none; color: inherit;">
                    <strong style="color: #333;">{{ task.subject_display }}</strong><br>
                    <small style="color: #888;">Received: {{ task.received_at|date:"d M Y H:i" }}</small>
                </a>
            </td>

            <td onclick="window.location.href='{% url 'outlook_delegated_action' delegation_id=task.pk %}';">
                {{ task.company_code|default:"N/A" }}
            </td>

            <td onclick="window.location.href='{% url 'outlook_delegated_action' delegation_id=task.pk %}';">
                {{ task.email_category|default:"Non-work related" }}
            </td>

            <td style="text-align: center;" onclick="event.stopPropagation();">
                <a href="{% url 'outlook_delegated_action' delegation_id=task.pk %}" class="btn-restore">
                    üëÅÔ∏è View & Restore
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
    {% else %}
    <div style="text-align: center; padding: 50px;">
        <p style="font-size: 1.2em; color: #666;">üéâ The Recycle Bin is currently empty.</p>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search_input');
    const tableBody = document.getElementById('table_body');
    const selectAllCheckbox = document.getElementById('select_all');
    const deleteButton = document.getElementById('delete_btn');
    
    if (searchInput && tableBody) {
        searchInput.addEventListener('input', function() {
            const filter = searchInput.value.toLowerCase();
            const rows = tableBody.getElementsByClassName('data-row');
            Array.from(rows).forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(filter) ? "" : "none";
            });
        });
    }

    function updateDeleteButton() {
        const checkedCount = document.querySelectorAll('.delete-checkbox:checked').length;
        if (deleteButton) {
            deleteButton.disabled = checkedCount === 0;
            deleteButton.textContent = checkedCount > 0 ? `üóëÔ∏è Delete Selected (${checkedCount})` : `üóëÔ∏è Delete Selected`;
        }
    }

    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
            document.querySelectorAll('.delete-checkbox').forEach(cb => cb.checked = this.checked);
            updateDeleteButton();
        });
    }

    if (tableBody) {
        tableBody.addEventListener('change', function(e) {
            if (e.target.classList.contains('delete-checkbox')) {
                updateDeleteButton();
            }
        });
    }
});
</script>
</body>
</html>