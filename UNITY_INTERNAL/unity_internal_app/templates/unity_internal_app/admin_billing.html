{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Billing History | Unity Internal</title>
    <style>
        /* --- INTEGRATED GLOBAL STYLES --- */
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        body { 
            font-family: sans-serif; 
            font-size: 14px; 
            background: linear-gradient(to bottom, #d1e2c4, #d1e2c4); 
            color: #333; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        
        .container { 
            width: 95%; max-width: 98%; height: 90vh; display: flex; flex-direction: column; 
            background-color: #f0fff0; padding: 1.5em; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,.1); 
        }

        /* HEADER & BUTTONS */
        .dashboard-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .dashboard-button { 
            padding: 8px 16px; background-color: #81c784; border: 1px solid #81c784; border-radius: 5px; 
            text-decoration: none; color: white; font-weight: 700; transition: background-color .3s ease; font-size: 13px; cursor: pointer; 
        }
        .dashboard-button:hover { background-color: #66bb6a; }
        h1 { color: #1b5e20; text-align: center; flex-grow: 1; font-size: 22px; margin: 0; }

        /* SUMMARY BOX */
        .summary-box {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            color: #1b5e20;
            font-weight: 500;
            font-size: 13px;
        }

        /* SEARCH/FILTER CONTAINER */
        .search-container { 
            display: flex; gap: 10px; margin-bottom: 15px; background: #e8f5e9; padding: 15px; 
            border-radius: 8px; border: 1px solid #c8e6c9; align-items: flex-end; 
        }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-label { font-size: 11px; font-weight: bold; color: #1b5e20; margin-bottom: 2px; }
        .search-input { padding: 8px; border: 1px solid #aed581; border-radius: 4px; font-size: 14px; background: white; }

        /* TABLE STYLES */
        .table-wrapper { overflow-y: auto; flex: 1; border: 1px solid #aed581; border-radius: 4px; background: white; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #aed581; font-size: 13px; word-wrap: break-word; }
        th { background-color: #e6ffe6; color: #1b5e20; font-weight: 700; position: sticky; top: 0; z-index: 10; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #e8f5e9; }

        .amount-col { text-align: right; }
        .fee-col { text-align: right; font-weight: bold; color: #2e7d32; }
    </style>
</head>
<body>

<div class="container">
    <div class="dashboard-header">
        <a href="{% url 'dashboard' %}" class="dashboard-button">‚Üê Back to Home Screen</a>
        <h1>üíª Admin Billing Overview</h1>
    </div>

    <div class="summary-box">
        <strong>Recon Percentage:</strong> 0.3% (0.003) based on monthly salary per bill. 
        <br><small>Note: Each bill is listed separately per fiscal period.</small>
    </div>

    <form method="GET" action="" class="search-container">
        <div class="filter-group" style="flex: 1;">
            <label for="start_date" class="filter-label">START DATE (BILL PERIOD)</label>
            <input type="date" class="search-input" id="start_date" name="start_date" value="{{ filter_start_date }}">
        </div>

        <div class="filter-group" style="flex: 1;">
            <label for="end_date" class="filter-label">END DATE (BILL PERIOD)</label>
            <input type="date" class="search-input" id="end_date" name="end_date" value="{{ filter_end_date }}">
        </div>

        <button type="submit" class="dashboard-button">üîç Apply Filter</button>
        <a href="{% url 'admin_billing' %}" class="dashboard-button" style="background-color: #757575; border-color: #757575;">Clear Filter</a>
    </form>
    
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th style="width: 12%;">Fiscal Period</th>
                    <th style="width: 10%;">Code</th>
                    <th style="width: 18%;">Company Name</th>
                    <th style="width: 10%;">Members</th>
                    <th style="width: 13%;" class="amount-col">Salary</th>
                    <th style="width: 13%;" class="fee-col">Fee (0.3%)</th>
                    <th style="width: 12%;">Confirmed By</th>
                    <th style="width: 12%;">Date</th>
                </tr>
            </thead>
            <tbody>
                {% for record in bill_records %}
                <tr>
                    <td><strong>{{ record.fiscal_period }}</strong></td>
                    <td>{{ record.company_code }}</td>
                    <td>{{ record.company_name }}</td>
                    <td>{{ record.active_members }}</td>
                    <td class="amount-col">R {{ record.total_schedule_amount|default:"0.00"|floatformat:2 }}</td>
                    <td class="fee-col">R {{ record.total_admin_fee|floatformat:2 }}</td>
                    <td>{{ record.posted_user }}</td>
                    <td>{{ record.posted_date|date:"Y-m-d"|default:"N/A" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                        No individual bill records found matching the criteria.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</body>
</html>