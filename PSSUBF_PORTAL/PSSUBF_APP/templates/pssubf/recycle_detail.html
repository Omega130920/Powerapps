{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Review Recycled Task | PSSUBF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.3);
            --glass-border: rgba(255, 255, 255, 0.4);
            --danger-red: #842029;
            --accent-red: #dc3545;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            line-height: 1.6; 
            /* Reddish gradient to signify Recycle Bin environment */
            background: linear-gradient(135deg, #f8d7da 0%, #f5c2c7 100%); 
            min-height: 100vh; 
            padding: 40px 20px;
            color: var(--danger-red);
        }

        /* --- GLASS CONTAINER --- */
        .delegate-container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 40px; 
            background: var(--glass-bg); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 24px; 
            box-shadow: 0 8px 32px rgba(132, 32, 41, 0.15); 
            border: 1px solid var(--glass-border); 
        }

        .delegate-container h1 { 
            margin-bottom: 25px; 
            color: var(--danger-red); 
            font-size: 28px; 
            font-weight: 300;
            border-bottom: 1px solid var(--glass-border); 
            padding-bottom: 15px; 
        }

        /* --- EMAIL THREAD CARD --- */
        .email-thread-card { 
            background: rgba(255, 255, 255, 0.4); 
            border-radius: 16px; 
            margin-bottom: 30px; 
            border: 1px solid var(--glass-border); 
            border-left: 6px solid var(--accent-red); 
            overflow: hidden;
        }

        .card-header-main { 
            padding: 15px 20px; 
            background: rgba(255, 255, 255, 0.2); 
            border-bottom: 1px solid var(--glass-border); 
        }

        .card-header-main h3 { 
            margin: 0; 
            color: var(--danger-red); 
            font-size: 1.1em; 
            font-weight: 600;
        }
        
        .card-body-content { 
            padding: 25px; 
            height: 450px; 
            overflow-y: auto; 
            background: rgba(255, 255, 255, 0.5); 
            font-size: 14px; 
            line-height: 1.7;
        }

        /* --- ATTACHMENTS --- */
        .attachment-list { 
            padding: 15px 20px; 
            background: rgba(220, 53, 69, 0.05); 
        }

        .attachment-item { 
            display: inline-flex; 
            align-items: center; 
            background: rgba(255, 255, 255, 0.6); 
            padding: 6px 14px; 
            border: 1px solid var(--glass-border); 
            border-radius: 20px; 
            margin: 0 10px 10px 0; 
            transition: 0.2s; 
        }

        .attachment-link { 
            color: var(--danger-red); 
            text-decoration: none; 
            font-size: 13px; 
            font-weight: 600; 
        }

        /* --- UI ELEMENTS --- */
        .alert-glass {
            background: rgba(248, 215, 218, 0.6);
            border: 1px solid rgba(132, 32, 41, 0.2);
            color: var(--danger-red);
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .subject-box {
            padding: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* --- BUTTONS --- */
        .button-container { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-top: 30px; 
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }

        .btn-glass-back { 
            padding: 10px 20px; 
            background: rgba(0, 0, 0, 0.05); 
            color: var(--danger-red); 
            border: 1px solid var(--glass-border);
            border-radius: 12px; 
            text-decoration: none; 
            font-weight: 600;
            transition: 0.2s;
        }
        .btn-glass-back:hover { background: rgba(255,255,255,0.4); }

        .btn-restore { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 12px 30px; 
            background: #0d6efd; 
            color: white; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold; 
            text-decoration: none;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
        }

        .btn-restore:hover { 
            background: #0b5ed7; 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(13, 110, 253, 0.4);
            color: white;
        }
    </style>
</head>
<body>

<div class="delegate-container">
    <h1><i class="bi bi-trash3-fill me-2"></i> Review <strong>Recycled Item</strong></h1>
    
    <div class="alert alert-glass mb-4 shadow-sm">
        <i class="bi bi-exclamation-triangle-fill me-2"></i> This item is currently in the <strong>Recycle Bin</strong> and is hidden from agents.
    </div>

    <div class="mb-4">
        <label class="fw-bold small opacity-75 text-uppercase mb-1">Email Subject:</label>
        <div class="subject-box">{{ email_subject }}</div>
    </div>
    
    <div class="email-thread-card shadow-sm">
        <div class="card-header-main">
            <h3>Communication Content</h3>
        </div>
        <div class="card-body-content">
            {% if email_content %}
                {{ email_content|safe }}
            {% else %}
                <p class="text-muted fst-italic">No email body content found.</p>
            {% endif %}
        </div>
        
        {% if attachments %}
        <div class="attachment-list">
            <strong class="d-block mb-2 text-danger small text-uppercase"><i class="bi bi-paperclip me-1"></i> Attachments Detected:</strong>
            <div class="d-flex flex-wrap">
                {% for att in attachments %}
                <div class="attachment-item">
                    <a href="{% url 'download_pssubf_attachment' message_id=email_id attachment_id=att.id %}" class="attachment-link">
                        <i class="bi bi-cloud-download me-1"></i> {{ att.name }}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <div class="button-container">
        <a href="{% url 'pssubf_recycle_bin' %}" class="btn-glass-back">
            <i class="bi bi-arrow-left me-1"></i> Back to Bin
        </a>
        <a href="{% url 'pssubf_restore' email_id %}" class="btn-restore">
            <i class="bi bi-arrow-counterclockwise"></i> Restore to Queue
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>